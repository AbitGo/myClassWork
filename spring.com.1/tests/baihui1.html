<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <!--不进行网页缓存-->
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=8">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  <title>佰汇广场</title>
  <!--user-scalable=no禁用网页缩放功能，确保其更像原生APP-->
  <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
  <!--初始化移动浏览显示  确保绘制和触屏缩放-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <!--[if lt IE 9]>
  <script src="../js/html5shiv.min.js"></script>
  <script src="../js/respond.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" media="all" href="../jquery-jvectormap.css"/>
  <!--Bootstrap-->

  <script src="../js/jquery-1.11.1.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>

  <!--支持库-->
  <script src="assets/jquery-1.8.2.js"></script>
  <script src="../jquery-jvectormap.js"></script>
  <script src="../js/jquery-mousewheel.js"></script>
  <script src="../src/jvectormap.js"></script>
  <script src="../src/abstract-element.js"></script>
  <script src="../src/abstract-canvas-element.js"></script>
  <script src="../src/abstract-shape-element.js"></script>
  <script src="../src/svg-element.js"></script>
  <script src="../src/svg-group-element.js"></script>
  <script src="../src/svg-canvas-element.js"></script>
  <script src="../src/svg-shape-element.js"></script>
  <script src="../src/svg-path-element.js"></script>
  <script src="../src/svg-circle-element.js"></script>
  <script src="../src/svg-image-element.js"></script>
  <script src="../src/svg-text-element.js"></script>
  <script src="../src/vml-element.js"></script>
  <script src="../src/vml-group-element.js"></script>
  <script src="../src/vml-canvas-element.js"></script>
  <script src="../src/vml-shape-element.js"></script>
  <script src="../src/vml-path-element.js"></script>
  <script src="../src/vml-circle-element.js"></script>
  <script src="../src/vml-image-element.js"></script>
  <script src="../src/map-object.js"></script>
  <script src="../src/region.js"></script>
  <script src="../src/marker.js"></script>
  <script src="../src/vector-canvas.js"></script>
  <script src="../src/simple-scale.js"></script>
  <script src="../src/ordinal-scale.js"></script>
  <script src="../src/numeric-scale.js"></script>
  <script src="../src/color-scale.js"></script>
  <script src="../src/legend.js"></script>
  <script src="../src/data-series.js"></script>
  <script src="../src/proj.js"></script>
  <script src="../src/map.js"></script>
  <script src="../lib/conn.js"></script>
  <!--地图数据-->
  <script src="assets/baihuiSquare/jquery-jvectormap-baihui-1-en.js"></script>
  <script src="assets/jquery-jmapplus-line-js-mill-cn.js"></script>

  <script>


  $(document).ready(function(){
    $(function(){

      var values1 = [408, 512, 550, 781];//设置两个图层 里面的数值为图中的渐进线
     //var markerIndex = 0,markersCoords = {};
      var values3 = {
        '4': 'bank',
        '5': 'factory'
      };
      var values4 = {
        "BH-煌上煌":'color2',
        "BH-中国建设银行":'color4',

      };
      var map = new jvm.Map({

        container: $('.map'),//把class为map的标签作为容器名
        map: 'us_aea_en',//载入地图的名称
        labels: {
          regions: {
            render: function(code){
              var doNotShow = ['BH-16号甜品'];//不要展示的标识  如柱子等
              if (doNotShow.indexOf(code) == -1) {
                return code.split('-')[1];
              }
            },
          },
          offsets: function(code){
            return {
              '闺蜜': [-10, 10],
              "BH-A1": [-10, 10],

              "BH-A2":[-10, 10],
              "BH-A3":[-10, 10],
            }[code.split('-')[1]];
          }
        },
        markers: {
          render: function(index){

            return 'Marker '+index;
          }
        },
        markerStyle: {//地图标记
          initial: {
            fill: 'red'
          }
        },
        zoomMin:0.5,//表示地图可以显示的最小倍数，默认为1
        zoomMax:8,//表示地图可以显示的最大倍数，默认为8
        backgroundColor:'#FFF',//地图背景颜色#FFF  C8EEFF
        regionsSelectable:true,//区域是否可选
       //--------------------------------------------------
        series: {//两个键分别为markers和regions颜色，用于向地图上添加数据
          markers: [{
            attribute: 'fill',
            scale: ['#C8EEFF', '#0071A4'],
            normalizeFunction: 'polynomial',//规范化函数polynomial  右边的标识
            values: values1,
            legend: {
              vertical: true
            }
          },{//插图
            attribute: 'image',
            scale: {
              bank: 'assets/icon-bank.png',
              factory: 'assets/icon-factory.png'
            },
            values: values3,
            legend: {
              horizontal: true,
              cssClass: 'jvectormap-legend-icons',
              title: '停车场'
            }
          }],

         regions: [{//区域
           scale: {
               color1:'#CAE2F3',//蓝色
               color2:'#F6BCCA',//粉色
               color3:'#C4D9CC',//藏青
               color4:'#F8CEC0',//橙色
               color5:'#E5E3D1',//灰色
               color6:'#C82209'//红色
           },
           attribute: 'fill',
           normalizeFunction: 'polynomial',
            values:values4,
           // {
           //    "latLng":'color1',
               //区域一
              //  "BH-22": 'color1',
              //  "BH-23": 'color1',
              //  "BH-24": 'color1',
              //  "BH-25": 'color1',
              //  "BH-26": 'color1',
              //  "BH-28": 'color1',
              //  "BH-29": 'color1',
              //  "BH-30": 'color1',
           //     //
           //     // //区域二
           //     // "BH-01":'color2',
           //     // "BH-02":'color2',
           //     // "BH-03":'color2',
           //     // "BH-04":'color2',
           //     // "BH-中国福利彩票":'color2',
           //     // "BH-九疑米粉":'color2',
           //      "BH-煌上煌":'color2',
           //     // "BH-煌上煌":'color2',
           //      //"BH-垂直电梯2":'color2',
           //     // "BH-佰汇服务中心":'color2',
           //     //
           //     // //区域三
           //     // 'BH-05':'color3',
           //     // 'BH-06':'color3',
           //     // 'BH-07':'color3',
           //     // 'BH-08':'color3',
           //     // 'BH-09':'color3',
           //     // 'BH-10':'color3',
           //     // 'BH-11':'color3',
           //     // 'BH-12':'color3',
           //     // 'BH-13':'color3',
           //     // 'BH-14':'color3',
           //     // 'BH-15':'color3',
           //     // 'BH-19':'color3',
           //     // 'BH-20':'color3',
           //     // 'BH-27':'color3',
           //     // 'BH-纤艺美甲':'color3',
           //     // 'BH-水果美容体':'color3',
           //     // 'BH-佰汇公寓酒店':'color3',
           //     // 'BH-都市恋人坊':'color3',
           //     // 'BH-俏依人':'color3',
           //     // 'BH-16号甜品':'color3',
           //     // 'BH-闺蜜':'color3',
           //     // 'BH-么么哒':'color3',
           //     // 'BH-七月初七':'color3',
           //     // 'BH-体态美':'color3',
           //     // 'BH-蜜菓':'color3',
           //     //
           //     // //区域四
           //     // "BH-16":'color4',
           //     // "BH-17":'color4',
           //     // "BH-18":'color4',
           //     "BH-中国建设银行":'color4',
           //     // "BH-多多宝":'color4',
           //     // "BH-黑龙茶":'color4',
           //     // "BH-蒸美味":'color4',
           //     // "BH-孺子牛杂":'color4',
           //     // "BH-集信饮食":'color4',
           //     // "BH-温妮服饰":'color4',
           //     // "BH-衣生衣世":'color4',
           //     // "BH-再来一面":'color4',
           //     // "BH-蒂米雪":'color4',
           //     // "BH-哎呀呀":'color4',
           //     // "BH-摩天轮":'color4',
           //     // "BH-康奈":'color4',
           //     // "BH-爱婴岛":'color4',
           //     // "BH-佰汇销售招商":'color4',
           //     // //区域五
           //     // "BH-21":'color5',
           //     // //区域六
           //     // "BH-31":'color6',
           //     // "BH-32":'color6',
           // }
         },{
           scale: {
             color1:'#CAE2F3',//蓝色
             color2:'#F6BCCA',//粉色
             color3:'#C4D9CC',//藏青
             color4:'#F8CEC0',//橙色
             color5:'#E5E3D1',//灰色
             color6:'#C82209'//红色
           },
           attribute: 'fill',
           normalizeFunction: 'polynomial',
           values: {
             "BH-我的位置":'color4',//可用于标记地图
           },
           attribute: 'fill'
         }]
       },

       //----------------------------------------
        regionLabelStyle:
        {
          initial: {
            'font-family': 'Verdana',
            'font-size': '10',
            'font-weight': '',
            cursor: 'default',
            fill: 'black'
          },
          hover: {
            cursor: 'pointer'
          }
        },

        regionStyle:
        {
          initial: {
//            fill: '#FF8247',//#FF8247
//            "fill-opacity": 1,//透明度
             stroke: '#CDCDCD',
            "stroke-width":1.5,
            "stroke-opacity": 5
          },
          hover: {
            "fill-opacity": 0.8,
            cursor: 'pointer'
          },
          selected: {
            fill: 'red'
          },
          selectedHover: {
          }
        },

        regionsSelectableOne:true,
        selectedRegions: JSON.parse( window.localStorage.getItem('jvectormap-selected-regions-BH-1') || '[]' ),//选择区域
        selectedMarkers: JSON.parse( window.localStorage.getItem('jvectormap-selected-markers') || '[]' ),//选择标记
		/*
        onMarkerTipShow: function(event, tip, index){//在显示标记之前调用
          tip.html(tip.html()+' (modified marker)');
        },*/
        // onMarkerTipShow: function(e, label, code){//显示标记使用
        //   map.tip.text(markersCoords[code].lat.toFixed(2)+', '+markersCoords[code].lng.toFixed(2));
        // },
        // onMarkerClick: function(event, index){//点击标记
        //   console.log('marker-click', index);
        // },
        // onMarkerTipShow: function(e, tip, code){
        //   map.tip.text(markersCoords[code].lat.toFixed(2)+' '+markersCoords[code].lng.toFixed(2));
        // },
        // onMarkerClick: function(e, code){
        //   map.removeMarkers([code]);
        //   map.tip.hide();
        // },
        onMarkerOver: function(event, index){//点击商铺触发的方法
          console.log('marker-over', index);
        },
        onMarkerOut: function(event, index){
          console.log('marker-out', index);
        },


        onMarkerSelected: function(event, index, isSelected, selectedMarkers){
          console.log('marker-select', index, isSelected, selectedMarkers);
          if (window.localStorage) {
            window.localStorage.setItem(
              'jvectormap-selected-markers-BH-1',
              JSON.stringify(selectedMarkers)
            );
          }
        },
		/*
        onRegionTipShow: function(event, tip, code){
          tip.html(tip.html()+' (modified)');
        },*/
        onRegionOver: function(event, code){

           // console.log(map.series.regions);
          console.log('==============》region-over', code);//鼠标移入操作
        },
        onRegionOut: function(event, code){
          console.log('==============》region-out', code);//鼠标移出操作
        },
        onRegionClick: function(event, code){
          console.log('==============》region-click', "code : "+code);//鼠标点击操作
		  //changeText( code.split('-')[1]);
		  //显示弹窗
          showDialog(code.split('-')[1]);
          //点击动画
          //$('.map').vectorMap('set', 'focus', {region: code, animate: true});
        },
        onRegionSelected: function(event, code, isSelected, selectedRegions){
          console.log('==============》region-select', code, isSelected, selectedRegions);
          if (window.localStorage) {
            window.localStorage.setItem(
              'jvectormap-selected-regions-BH-1',
              JSON.stringify(selectedRegions)//将js的值转换成json字符串的形式
            );
          }
        },
        onViewportChange: function(e, scale, transX, transY){//设置店铺的文字随地图缩放
          console.log('viewportChange', scale, transX, transY);
          var old = parseInt($("text").css("fontSize"));
          console.log("字体大小：" + old);
          if( scale < 2.5 || scale == 2.5 ){
            $("text").hide();

          }
          else if(scale > 2.5 && scale < 3.5  || scale == 3.5){
            $("text").css("fontSize", 9);
            $("text").show();
          }
          else if(scale > 3.5 && scale < 4.5  || scale == 4.5){
            $("text").css("fontSize", 10);
            $("text").show();
          }
          else if(scale > 4.5 && scale < 5.5  || scale == 5.5){
            $("text").css("fontSize", 14);
            $("text").show();
          }
          else{
            $("text").css("fontSize", 16);
            $("text").show();
          }
        },


     });
    });

      var shopName;
      /**显示弹窗*/
      function showDialog(code){
          //判断是否存在该店铺信息
          shopName = code;
          $(".shopNameSpan")[0].innerHTML = shopName;//店名
          $(".shopDetail")[0].innerHTML = "店铺详情>";
          $(".dialogBodyPhone")[0].innerHTML = "6666 8888";//电话
          $(".dialogBodyAddress")[0].innerHTML = "1楼55卡";//地址
          $(".shopImg").eq(0).attr("src","../image/shop.jpg");

          $(".box").show();
      }

	   /**设置起点终点*/
      $(".addContentBtn").click(function(){
        var tipId = $(this).attr("data-tip");
        $("#" + tipId).addClass("hasContent");
        if(tipId == "startTip")
        {
          $("#startName")[0].innerHTML = shopName.toString();
          $(".box").hide();
        }
        else if(tipId == "endTip"){
          $("#endName")[0].innerHTML = shopName.toString();
          $(".box").hide();
        }
      });

      $(".removeContentBtn").click(function(){
        var tipId = $(this).attr("data-tip");
        $("#" + tipId).removeClass("hasContent");
      })

  });
//   alert(map.container.offsetLeft = 10;)
//
//   $('.map').click(function(e){
//     var x = e.pageX - map.container.offset().left,
//             y = e.pageY - map.container.offset().top,
//             latLng = map.pointToLatLng(x, y),
//             targetCls = $(e.target).attr('class');
// alert(latLng);
//     if (latLng && (!targetCls || targetCls.indexOf('jvectormap-marker') === -1)) {
//       markersCoords[markerIndex] = latLng;
//       map.addMarker(markerIndex, {latLng: [latLng.lat, latLng.lng]});
//       markerIndex += 1;
//     }});
  </script>
</head>
<body>
  <div class="head">
    <button id="locationBtn" type="button" class="btn btn-sm" style="background: #FF8247">
      <span class="glyphicon glyphicon-map-marker" aria-hidden="true" style="color: #FFFFFF"></span>
    </button>
    <!-- Split button -->
	<div class="btn-group">
      <button type="button" class="btn btn-sm" style="color:#FFF;background: coral">楼层选择</button>
      <button type="button" class="btn btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color:#FFF;background: #FF8247">
        <span class="caret"></span>
        <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu">
          <li><a href="#">一楼</a></li>

      </ul>
    </div>
  </div>
  <div  class="map"></div><!--地图容器-->
  
  <div class="footer">
    <div class="tipPanel">
        <span id="startTip" style="font-size:14px">起&nbsp&nbsp&nbsp&nbsp点：</span>
        <span id="startName" style="font-size:14px"></span>
      </div><!--起点层-->
      <div class="tipPanel">
        <span id="endTip" style="font-size:14px">目标点：</span>
        <span id="endName" style="font-size:14px"></span>
      </div><!--终点层-->

    <div class="routeDiv">
	  <!--<img style="width:100%" src="../image/routeBtnIcon.png">-->
      <button id="routeBtn" type="button" class="btn btn-default" style="background: #FFFFFF;color: #FF8247;width: 100%;height: 45px ">
        <span class="glyphicon glyphicon-road" aria-hidden="true" style="color: #FF8247"></span> 路线
      </button>
    </div><!--路线层-->
  </div>
  <input type="button" value="获取数据" id="btn"/>
  <ul class="list-markers">
    <li data-marker-index="0"><label><input checked type="checkbox"/> Marker 1</label></li>
    <li data-marker-index="1"><label><input checked type="checkbox"/> Marker 2</label></li>
    <li data-marker-index="2"><label><input checked type="checkbox"/> Marker 3</label></li>
    <li data-marker-index="3"><label><input checked type="checkbox"/> Marker 4</label></li>
    <li data-marker-index="4"><label><input checked type="checkbox"/> Marker 5</label></li>
    <li data-marker-index="5"><label><input checked type="checkbox"/> Marker 6</label></li>
  </ul>
  <input type="button" value="Add all" class="button-add-all"/>
  <a href="#" onclick="on()">打开</a>
  <!--提示框-->
  <div class="box">
    <div class="box1">
      <!--<a href="javascript:;" onclick="jQuery('.box').hide()" class="close">关闭</a>-->
      <div class="dialogHead">
        <span class="shopNameSpan"></span>
        <a class="shopDetail">店铺详情></a>
      </div>
      <div class="dialogBody">
        <div class="dialogBodyLeft">
          <span class="dialogBodyAddress">正佳广场三层312卡</span>
          <span class="dialogBodyPhone">020-2559454135</span>
        </div>

        <div class="dialogBodyRight">
          <img class="shopImg" src="../image/shop.jpg">
        </div>

      </div>
      <div class="dialogFooter">
		<button id="dialogFooterStart" data-tip="startTip" class="addContentBtn btn btn-default" style="color:#FF8247;">设为起点</button>
        <button id="dialogFooterEnd" data-tip="endTip" class="addContentBtn btn btn-default" style="color:#FF8247;">设为目的地</button>
      </div>
    </div>
  </div>

</body>

</html>